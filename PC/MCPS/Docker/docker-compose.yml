version: '3.9'

# MCP Universal Docker Compose - merged
# Combina serviços HTTP/SSE persistentes e notas de uso para MCPs STDIO

services:
  # CONTEXT7 - Documentação de bibliotecas (HTTP/SSE)
  context7:
    image: mcp/context7:latest
    container_name: DevSan-MCP-context7
    ports:
      - "8080:8080"
    environment:
      - CONTEXT7_API_KEY=${CONTEXT7_API_KEY}
      - FASTMCP_LOG_LEVEL=${FASTMCP_LOG_LEVEL:-ERROR}
    volumes:
      - context7-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - mcp-network

  # TAVILY - recomendado como STDIO (mantido como daemon para conveniência)
  tavily:
    image: mcp/tavily:latest
    container_name: DevSan-MCP-tavily
    ports:
      - "3000:3000"
    volumes:
      - tavily-data:/data
    restart: unless-stopped

  fetch:
    image: mcp/fetch:latest
    container_name: DevSan-MCP-fetch
    ports:
      - "9000:9000"
    restart: unless-stopped

  dockerhub:
    image: mcp/dockerhub:latest
    container_name: DevSan-MCP-dockerhub
    ports:
      - "5000:5000"
    restart: unless-stopped

  filesystem:
    image: mcp/filesystem:latest
    container_name: DevSan-MCP-filesystem
    ports:
      - "7000:7000"
    command: ["/", "/tmp"]
    volumes:
      - /:/host
    restart: unless-stopped

  firecrawl:
    image: mcp/firecrawl:latest
    container_name: DevSan-MCP-firecrawl
    ports:
      - "6000:6000"
    environment:
      - FIRECRAWL_API_KEY=${FIRECRAWL_API_KEY:-fc-d3156cdf9a444ce380f7c87b6090fb30}
    restart: unless-stopped

  youtube-transcription:
    image: mcp/youtube-transcript:latest
    container_name: DevSan-MCP-youtube-transcription
    ports:
      - "7001:7001"
    restart: unless-stopped

  desktop-commander:
    image: mcp/desktop-commander:latest
    container_name: DevSan-MCP-desktop-commander
    ports:
      - "8000:8000"
    restart: unless-stopped

  agent:
    image: mcp/agent:local
    container_name: DevSan-MCP-agent
    ports:
      - "4000:4000"
    restart: unless-stopped

  gateway:
    image: docker/mcp-gateway:latest
    container_name: DevSan-MCP-gateway
    ports:
      - "9090:9090"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
    restart: unless-stopped

networks:
  mcp-network:
    driver: bridge
    name: mcp-universal-network

volumes:
  context7-data: {}
  tavily-data: {}
  mcp-memory-data:
    name: mcp-memory-data

# Notes:
# - Template mergeado: revise imagens, tags e env vars.
# - Para MCPs STDIO (tavily, fetch, memory), considere usar `docker run -i --rm` conforme notas.
# - Use: `docker-compose -f docker-compose.yml up -d` para levantar os serviços persistentes.

